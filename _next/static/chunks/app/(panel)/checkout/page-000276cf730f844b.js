(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5257],{2844:(e,t,s)=>{Promise.resolve().then(s.bind(s,7304))},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},7304:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(5155),r=s(5695),l=s(2115),n=s(8406),c=s(6874),i=s.n(c);function o(e){if(!e)return 0;let t="۰۱۲۳۴۵۶۷۸۹",s=e.toString();for(let e=0;e<t.length;e++)s=s.replace(RegExp(t[e],"g"),"0123456789"[e]);let a=parseInt(s.replace(/,/g,"").replace(/\s/g,"").replace(/[^\d]/g,"").trim(),10);return isNaN(a)?0:a}function d(){var e;let t,s=(0,r.useSearchParams)(),c=(0,r.useRouter)(),{isLoggedIn:d,openAuthModal:m}=(0,n.A)(),[u,x]=(0,l.useState)(!1),[p,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=s.get("type"),t=s.get("brand"),a=s.get("symbol"),r=s.get("name"),l=s.get("amount"),n=s.get("amountType");if("crypto"===e){if(!a||!r||!l){c.push("/crypto/buy");return}h({type:"crypto",symbol:a,name:r,amount:parseFloat(l),quantity:1,totalPrice:l,amountType:n||"usd"})}else if("card"===e||"paypal"===e){let t=s.get("cardType"),a=s.get("plan"),r=s.get("quantity"),l=s.get("price"),n=s.get("totalPrice");if("card"===e&&t&&r&&n){let e=parseInt(r,10)||1,s=o(n),a=l?o(l):0,c=0;a>0?c=a:e>0&&s>0&&(c=Math.floor(s/e)),h({type:"gift-card",brand:t,amount:c,quantity:e,totalPrice:s.toString()})}else"paypal"===e&&a&&n&&h({type:"gift-card",brand:"paypal-".concat(a),amount:parseInt(n),quantity:1,totalPrice:n})}else{let e=s.get("quantity");if(!t||!l||!e){c.push("/gift-cards");return}let a=l?parseInt(l):void 0,r=s.get("totalPrice")||"0",n=o(r),i=parseInt(e)||1;h({type:"gift-card",brand:t,amount:i>0?Math.floor(n/i):0,quantity:i,totalPrice:n>0?n.toString():r,valueUsd:a})}},[s,c]),(0,l.useEffect)(()=>{if(!d){let e=setTimeout(()=>{m()},100);return()=>clearTimeout(e)}},[d,m]);let f=async()=>{if(p){x(!0);try{let e=await fetch("/api/payment/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:p.type,brand:p.brand,symbol:p.symbol,name:p.name,amount:p.amount,quantity:p.quantity,totalPrice:p.totalPrice,amountType:p.amountType})}),t=await e.json();t.success&&t.paymentUrl?window.location.href=t.paymentUrl:(alert("خطا در ایجاد تراکنش. لطفا دوباره تلاش کنید."),x(!1))}catch(e){console.error("Payment error:",e),alert("خطا در اتصال به درگاه پرداخت"),x(!1)}}};return p?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 sm:p-8 lg:p-12",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)(i(),{href:"crypto"===p.type?"/crypto/buy":"/gift-cards",className:"inline-flex items-center gap-2 text-slate-400 hover:text-slate-200 mb-6 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"بازگشت"]}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-100 mb-2",children:"تایید و پرداخت"}),(0,a.jsx)("p",{className:"text-slate-400",children:"لطفا اطلاعات سفارش را بررسی کنید"})]}),(0,a.jsxs)("div",{className:"glass-panel rounded-2xl p-6 sm:p-8 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-slate-100 mb-6",children:"خلاصه سفارش"}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-white/10",children:[(0,a.jsx)("span",{className:"text-slate-400",children:"محصول:"}),(0,a.jsx)("span",{className:"text-slate-200 font-medium",children:"crypto"===p.type?"".concat(p.name," (").concat(p.symbol,")"):"گیفت کارت ".concat(p.brand)})]}),(null===(e=p.brand)||void 0===e?void 0:e.startsWith("paypal-"))?null:(0,a.jsxs)(a.Fragment,{children:["gift-card"===p.type&&void 0!==p.valueUsd&&p.valueUsd>0&&(0,a.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-white/10",children:[(0,a.jsx)("span",{className:"text-slate-400",children:"ارزش کارت:"}),(0,a.jsxs)("span",{className:"text-slate-200 font-medium",children:[p.valueUsd.toLocaleString("fa-IR")," دلار"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-white/10",children:[(0,a.jsx)("span",{className:"text-slate-400",children:"crypto"===p.type?"مبلغ خرید:":"قیمت هر کارت:"}),(0,a.jsx)("span",{className:"text-slate-200 font-medium",children:"crypto"===p.type?(0,a.jsxs)(a.Fragment,{children:[p.amount.toLocaleString("fa-IR")," ","usd"===p.amountType?"دلار":p.symbol]}):(0,a.jsx)(a.Fragment,{children:(()=>{if(p.amount&&p.amount>0)return"".concat(p.amount.toLocaleString("fa-IR")," تومان");let e="string"==typeof p.totalPrice?o(p.totalPrice):Number(p.totalPrice)||0;if(p.quantity>0&&e>0){let t=Math.floor(e/p.quantity);if(t>0)return"".concat(t.toLocaleString("fa-IR")," تومان")}return"—"})()})})]}),"gift-card"===p.type&&(0,a.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-white/10",children:[(0,a.jsx)("span",{className:"text-slate-400",children:"تعداد:"}),(0,a.jsxs)("span",{className:"text-slate-200 font-medium",children:[p.quantity," عدد"]})]})]}),(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-lg text-slate-300 font-medium",children:"مبلغ قابل پرداخت:"}),(0,a.jsx)("span",{className:"text-3xl font-bold text-slate-100",children:"crypto"===p.type?"".concat(p.amount.toLocaleString("fa-IR")," ").concat("usd"===p.amountType?"دلار":p.symbol):(t="string"==typeof p.totalPrice?o(p.totalPrice):Number(p.totalPrice)||0)>0?"".concat(t.toLocaleString("fa-IR")," تومان"):"— تومان"})]})})]})]}),(0,a.jsxs)("div",{className:"glass-panel rounded-2xl p-6 sm:p-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-slate-100 mb-4",children:"انتخاب روش پرداخت"}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 mb-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-lg bg-cyan-500/20 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-cyan-400 text-xl",children:"\uD83D\uDCB3"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-slate-200 font-medium",children:"درگاه پرداخت"}),(0,a.jsx)("p",{className:"text-xs text-slate-400",children:"پرداخت امن و سریع"})]})]})})}),(0,a.jsx)("button",{onClick:f,disabled:u,className:"w-full px-6 py-4 bg-gradient-to-r from-cyan-500 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg hover:shadow-cyan-500/25 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"در حال اتصال به درگاه..."]}):"ادامه به درگاه پرداخت"}),(0,a.jsx)("p",{className:"text-xs text-slate-500 text-center mt-4",children:"با کلیک روی دکمه بالا، به صفحه پرداخت امن هدایت می‌شوید"})]}),(0,a.jsx)("div",{className:"mt-6 glass-panel rounded-2xl p-6",children:(0,a.jsxs)("div",{className:"flex items-start gap-3 text-sm text-slate-400",children:[(0,a.jsx)("span",{children:"\uD83D\uDD12"}),(0,a.jsx)("p",{children:"تمامی تراکنش‌ها به صورت امن و رمزگذاری شده انجام می‌شود. اطلاعات کارت بانکی شما نزد ما ذخیره نمی‌شود."})]})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-slate-400",children:"در حال بارگذاری..."})})})}function m(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 p-6 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-400",children:"در حال بارگذاری..."})]})}),children:(0,a.jsx)(d,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[6874,8406,8441,1684,7358],()=>t(2844)),_N_E=e.O()}]);