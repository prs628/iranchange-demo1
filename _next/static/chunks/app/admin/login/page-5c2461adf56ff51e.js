(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2116],{3727:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),o=r(2115),a=r(5695),n=r(9323),i=r(6874),l=r.n(i);function c(){let e=(0,a.useRouter)(),[t,r]=(0,o.useState)(!1),[i,c]=(0,o.useState)("");(0,o.useEffect)(()=>{let t=()=>{let t=localStorage.getItem("session_user_id");if(t){let r=JSON.parse(localStorage.getItem("users")||"[]").find(e=>e.id.toString()===t);r&&"admin"===r.role&&e.push("/admin")}};t();let r=setInterval(t,500);return()=>clearInterval(r)},[e]);let d=async t=>{t.preventDefault(),r(!0),c("");let s=new FormData(t.currentTarget),o=s.get("identifier"),a=s.get("password");if(!o||!a){c("لطفاً تمام فیلدها را پر کنید"),r(!1);return}try{var i;let t=await (0,n.iD)(o.trim(),a);if(!t.success){c(t.error||"ایمیل/شماره تلفن یا رمز عبور اشتباه است"),r(!1);return}if((null===(i=t.user)||void 0===i?void 0:i.role)!=="admin"){c("شما دسترسی ادمین ندارید. لطفاً از صفحه اصلی وارد شوید."),r(!1),localStorage.removeItem("session_user_id"),localStorage.removeItem("user_email"),localStorage.removeItem("user_phone"),localStorage.removeItem("user_name");return}e.push("/admin")}catch(e){console.error("Login error:",e),c("خطا در ورود. لطفاً دوباره تلاش کنید."),r(!1)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 relative flex items-center justify-center p-4",style:{height:"100vh",overflow:"hidden"},children:[(0,s.jsx)("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",children:(0,s.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 2px 2px, white 1px, transparent 0)",backgroundSize:"40px 40px"}})}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-md",children:(0,s.jsxs)("div",{className:"glass-card rounded-2xl p-8 shadow-2xl border border-white/10",children:[(0,s.jsxs)("div",{className:"mb-8 text-center",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-cyan-500 to-purple-600 mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"ورود به پنل ادمین"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"فقط برای مدیران سیستم"})]}),i&&(0,s.jsxs)("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg text-sm text-red-300 flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("span",{children:i})]}),(0,s.jsxs)("form",{onSubmit:d,className:"space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"identifier",className:"block text-sm font-medium text-gray-300 mb-2",children:"ایمیل یا شماره موبایل"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),(0,s.jsx)("input",{id:"identifier",name:"identifier",type:"text",required:!0,autoComplete:"username",disabled:t,className:"w-full pr-10 pl-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all disabled:opacity-50",placeholder:"admin@example.com"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"رمز عبور"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,s.jsx)("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"current-password",disabled:t,className:"w-full pr-10 pl-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all disabled:opacity-50",placeholder:"••••••••"})]})]}),(0,s.jsx)("button",{type:"submit",disabled:t,className:"w-full px-6 py-3.5 bg-gradient-to-r from-cyan-500 to-purple-600 text-white font-semibold rounded-lg hover:from-cyan-600 hover:to-purple-700 transition-all shadow-lg shadow-cyan-500/25 hover:shadow-cyan-500/40 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-cyan-500/25 flex items-center justify-center gap-2",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{children:"در حال ورود..."})]}):"ورود به پنل ادمین"})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsxs)(l(),{href:"/",className:"text-sm text-gray-400 hover:text-gray-300 transition-colors inline-flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"بازگشت به صفحه اصلی"]})})]})})]})}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},7101:(e,t,r)=>{Promise.resolve().then(r.bind(r,3727))},9323:(e,t,r)=>{"use strict";async function s(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}r.d(t,{M3:()=>w,Wy:()=>x,aN:()=>f,iD:()=>g,ku:()=>u,kz:()=>h,lo:()=>c,ri:()=>p,saveUsers:()=>d,u6:()=>m});let o="users",a="users_backup",n=!1,i=!1;function l(e){if(!e)return null;try{let t=JSON.parse(e);return Array.isArray(t)?t:null}catch(e){return console.error("❌ Error parsing users JSON:",e),null}}function c(){let e=l(localStorage.getItem(o));if(e)return e;let t=l(localStorage.getItem(a));return t?(console.warn("⚠️ Using users_backup because users JSON is invalid"),t):(console.log("\uD83D\uDCCB No valid users found in localStorage"),[])}function d(e){try{if(!Array.isArray(e)){console.error("❌ Cannot save users: not an array",e);return}let t=localStorage.getItem(o);t&&localStorage.setItem(a,t),localStorage.setItem(o,JSON.stringify(e)),localStorage.setItem("users_last_updated",Date.now().toString()),console.log("✅ Saved users to localStorage:",e.length,"users"),"undefined"!=typeof fetch&&Promise.all([fetch("http://localhost:3000/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:e})}).catch(()=>null),fetch("http://localhost:3001/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:e})}).catch(()=>null)]).then(()=>{console.log("\uD83D\uDCE1 Synced users to both ports via API")}).catch(e=>{console.warn("⚠️ Failed to sync to API:",e)}),window.dispatchEvent(new CustomEvent("usersUpdated")),console.log("\uD83D\uDCE2 Dispatched usersUpdated event from saveUsers")}catch(e){console.error("❌ Error saving users:",e)}}function u(){if(n)return;n=!0;try{if("1"===window.sessionStorage.getItem("admin_users_migrated_once"))return}catch(e){}let e=localStorage.getItem(o),t=localStorage.getItem("admin_users"),r=l(e)||[];if(t)try{let e=l(t)||[];if(Array.isArray(e)&&e.length>0){let t=e.map(e=>{let t=new Date().toISOString();if(e.joinDate)try{let r=new Date(e.joinDate);isNaN(r.getTime())||(t=r.toISOString())}catch(e){t=new Date().toISOString()}return{id:e.id||Date.now()+Math.random(),name:e.name||"",email:e.email||"",phone:e.phone||"",role:"admin"===e.role?"admin":"user",passwordHash:e.passwordHash||"",createdAt:t,orders:e.orders||0,totalSpent:e.totalSpent||"۰",status:e.status||"active",joinDate:e.joinDate,visibleGiftCards:e.visibleGiftCards||[]}}),s=new Map,o=e=>{let t=e.email&&e.email.trim().toLowerCase()||e.phone&&e.phone.trim()||e.id.toString();s.has(t)||s.set(t,e)};r.forEach(o),t.forEach(o);let a=Array.from(s.values());a.length!==r.length&&(console.log("✅ Migrated and merged users from admin_users into users:","before:",r.length,"after:",a.length),d(a)),localStorage.removeItem("admin_users"),localStorage.setItem("admin_users_migrated","true");try{window.sessionStorage.setItem("admin_users_migrated_once","1")}catch(e){}}}catch(e){console.error("❌ Error migrating users:",e)}}async function m(){if(!i){i=!0;try{if("1"===window.sessionStorage.getItem("admin_seeded_once"))return}catch(e){}try{let e=c();if(0===e.length)console.log("ℹ️ No users found, seeding default admin user");else if(e.some(e=>"admin"===e.role||"admin@example.com"===e.email))return;let t=await s("Admin@12345"),r={id:Date.now(),name:"مدیر سیستم",email:"admin@example.com",phone:"",role:"admin",passwordHash:t,createdAt:new Date().toISOString(),orders:0,totalSpent:"۰",status:"active",visibleGiftCards:[]};e.push(r),d(e),console.log("✅ Seeded default admin user:",r.email);try{window.sessionStorage.setItem("admin_seeded_once","1")}catch(e){}}catch(e){console.error("❌ Error seeding admin user:",e)}}}async function h(e,t,r,o){try{let a=c(),n=t.trim(),i=r.trim();console.log("\uD83D\uDD0D Registering user:",{name:e,email:n,phone:i,totalUsers:a.length});let l=a.find(e=>n&&e.email&&e.email===n?(console.log("❌ Found existing user with email:",e.email),!0):!!i&&!!e.phone&&e.phone===i&&(console.log("❌ Found existing user with phone:",e.phone),!0));if(l)return console.log("❌ User already exists:",l),{success:!1,error:"این ایمیل یا شماره تلفن قبلاً ثبت شده است"};console.log("✅ No duplicate found, creating new user...");let u=await s(o),m={id:Date.now(),name:e.trim(),email:n,phone:i,role:"user",passwordHash:u,createdAt:new Date().toISOString(),orders:0,totalSpent:"۰",status:"active",visibleGiftCards:[]};a.push(m),d(a),console.log("✅ New user registered and saved:",{id:m.id,name:m.name,email:m.email,phone:m.phone,totalUsers:a.length});try{fetch("/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:a})}).then(()=>{console.log("\uD83D\uDCE1 Synced users to API endpoint")}).catch(e=>{console.warn("⚠️ Failed to sync to API:",e)})}catch(e){}return window.dispatchEvent(new CustomEvent("usersUpdated")),console.log("\uD83D\uDCE2 Dispatched usersUpdated event"),{success:!0,user:m}}catch(e){return console.error("Registration error:",e),{success:!1,error:"خطا در ثبت نام"}}}async function g(e,t){try{let r=c(),o=e.includes("@"),a=o?e.trim():"",n=o?"":e.trim(),i=r.find(e=>e.email===a||e.phone===n);if(!i)return{success:!1,error:"Invalid email/phone or password"};if(!i.passwordHash||""===i.passwordHash)return{success:!1,error:"این حساب کاربری نیاز به تنظیم مجدد رمز عبور دارد. لطفاً دوباره ثبت نام کنید."};let l=await s(t);if(i.passwordHash!==l)return{success:!1,error:"Invalid email/phone or password"};return localStorage.setItem("session_user_id",i.id.toString()),localStorage.setItem("user_email",i.email),localStorage.setItem("user_phone",i.phone),localStorage.setItem("user_name",i.name),{success:!0,user:i}}catch(e){return console.error("Login error:",e),{success:!1,error:"خطا در ورود"}}}function p(){localStorage.removeItem("session_user_id"),localStorage.removeItem("user_email"),localStorage.removeItem("user_phone"),localStorage.removeItem("user_name")}function f(){try{let e=localStorage.getItem("session_user_id");if(!e)return null;return c().find(t=>t.id.toString()===e)||null}catch(e){return console.error("Error getting session user:",e),null}}function w(){return null!==f()}function x(){p()}}},e=>{var t=t=>e(e.s=t);e.O(0,[6874,8441,1684,7358],()=>t(7101)),_N_E=e.O()}]);