(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7581],{1304:(e,t,s)=>{Promise.resolve().then(s.bind(s,7115))},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},7115:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(5155),a=s(2115),n=s(5695),o=s(9323),l=s(6874),i=s.n(l);let c=[{title:"اصلی",items:[{key:"dashboard",title:"داشبورد",href:"/admin/dashboard",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}]},{title:"مدیریت",items:[{key:"orders",title:"سفارش‌ها",href:"/admin/orders",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),badge:"۱۲"},{key:"users",title:"کاربران",href:"/admin/users",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})},{key:"gift-cards",title:"گیفت کارت‌ها",href:"/admin/gift-cards",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v13m0-13V6a2 2 0 112 2v2m-2 13h6a2 2 0 002-2V9a2 2 0 00-2-2h-6m-6 0H4a2 2 0 00-2 2v12a2 2 0 002 2h6m6 0V9a2 2 0 00-2-2m-6 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})},{key:"transactions",title:"تراکنش‌ها",href:"/admin/transactions",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}]},{title:"تنظیمات",items:[{key:"settings",title:"تنظیمات سیستم",href:"/admin/settings",icon:(0,r.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}]}];function d(e){let{onLinkClick:t}=e,s=(0,n.usePathname)();return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"p-6 border-b border-white/10",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-r from-cyan-500 to-purple-600 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-bold text-lg",children:"A"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-bold text-slate-100",children:"پنل ادمین"}),(0,r.jsx)("p",{className:"text-xs text-slate-400",children:"مدیریت سیستم"})]})]})}),(0,r.jsx)("nav",{className:"flex-1 overflow-y-auto py-4",children:c.map((e,a)=>(0,r.jsxs)("div",{className:"mb-6",children:[e.title&&(0,r.jsx)("div",{className:"px-6 py-2 text-xs font-medium uppercase tracking-wider text-slate-500",children:e.title}),(0,r.jsx)("div",{className:"space-y-1",children:e.items.map(e=>{let a=s===e.href;return(0,r.jsxs)(i(),{href:e.href,onClick:t,className:"flex items-center gap-3 px-6 py-3 mx-2 rounded-xl transition-all ".concat(a?"bg-gradient-to-r from-cyan-500/20 to-purple-600/20 text-cyan-400 border border-cyan-500/30":"text-slate-300 hover:bg-white/5 hover:text-slate-100"),children:[e.icon,(0,r.jsx)("span",{className:"font-medium",children:e.title}),e.badge&&(0,r.jsx)("span",{className:"mr-auto px-2 py-0.5 text-xs font-semibold bg-red-500/20 text-red-400 rounded-full",children:e.badge})]},e.key)})})]},a))}),(0,r.jsx)("div",{className:"p-6 border-t border-white/10",children:(0,r.jsxs)(i(),{href:"/",className:"flex items-center gap-3 px-4 py-2 text-slate-300 hover:bg-white/5 rounded-lg transition-all",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,r.jsx)("span",{className:"font-medium",children:"بازگشت به سایت"})]})})]})}function m(e){var t;let{onMenuClick:s}=e,[l,i]=(0,a.useState)(!1),c=(0,n.useRouter)(),d=(0,o.aN)();return(0,r.jsx)("header",{className:"sticky top-0 z-10 glass-panel border-b border-white/10 backdrop-blur-xl",children:(0,r.jsx)("div",{className:"px-4 sm:px-6 lg:px-8 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,r.jsx)("button",{onClick:s,className:"lg:hidden p-2 text-slate-200 hover:text-white hover:bg-white/10 rounded-lg transition-colors","aria-label":"Open menu",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,r.jsx)("div",{className:"hidden md:flex flex-1 max-w-md",children:(0,r.jsxs)("div",{className:"relative w-full",children:[(0,r.jsx)("svg",{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,r.jsx)("input",{type:"text",placeholder:"جستجو...",className:"w-full pr-10 pl-4 py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/50"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>i(!l),className:"relative p-2 text-slate-200 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:[(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),(0,r.jsx)("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),(0,r.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-80 glass-panel rounded-xl shadow-2xl border border-white/10 p-4 z-20",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-slate-100",children:"اعلان‌ها"}),(0,r.jsx)("button",{className:"text-xs text-cyan-400 hover:text-cyan-300",children:"مشاهده همه"})]}),(0,r.jsxs)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,r.jsx)("p",{className:"text-sm text-slate-200",children:"سفارش جدید دریافت شد"}),(0,r.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"۲ دقیقه پیش"})]}),(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:[(0,r.jsx)("p",{className:"text-sm text-slate-200",children:"پرداخت موفقیت‌آمیز بود"}),(0,r.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"۱۵ دقیقه پیش"})]})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"text-left hidden sm:block",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-slate-100",children:(null==d?void 0:d.name)||"مدیر سیستم"}),(0,r.jsx)("p",{className:"text-xs text-slate-400",children:(null==d?void 0:d.email)||"admin@example.com"})]}),(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-cyan-500 to-purple-600 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-semibold",children:(null==d?void 0:null===(t=d.name)||void 0===t?void 0:t[0])||"م"})}),(0,r.jsx)("button",{onClick:()=>{(0,o.ri)(),c.push("/")},className:"px-3 py-1.5 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",children:"خروج"})]})]})]})})})}function u(e){let{children:t}=e,[s,l]=(0,a.useState)(!1),i=(0,n.usePathname)(),c=(0,n.useRouter)(),[u,h]=(0,a.useState)(!1),[x,p]=(0,a.useState)(!0),[g,f]=(0,a.useState)(null),[v,j]=(0,a.useState)(!1),w="/admin/login"===i;return((0,a.useEffect)(()=>{j(!0)},[]),(0,a.useEffect)(()=>{if(!v)return;let e=()=>{try{if(!localStorage.getItem("session_user_id")){h(!1),f(null),p(!1);return}let e=(0,o.aN)(),t=(0,o.M3)()&&(null==e?void 0:e.role)==="admin";h(t),f(t?e:null),p(!1)}catch(e){console.error("Auth check error:",e),p(!1)}};e();let t=t=>{"session_user_id"===t.key&&e()};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}},[v]),(0,a.useEffect)(()=>{if(!w&&!x){if(!u||!g){c.push("/admin/login");return}if("admin"!==g.role){c.push("/dashboard");return}}},[u,x,g,w,c]),w)?(0,r.jsx)(r.Fragment,{children:t}):!v||x?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-slate-400",children:"در حال بررسی دسترسی..."})]})}):u&&g&&"admin"===g.role?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950",children:[s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden",onClick:()=>l(!1)}),(0,r.jsx)("div",{className:"fixed right-0 top-0 bottom-0 w-[280px] z-50 lg:hidden",children:(0,r.jsx)("div",{className:"h-full glass-panel rounded-l-2xl shadow-2xl overflow-hidden",children:(0,r.jsx)(d,{onLinkClick:()=>l(!1)})})})]}),(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row relative",children:[(0,r.jsx)("aside",{className:"hidden lg:block w-64 shrink-0 relative",children:(0,r.jsx)("div",{className:"fixed right-0 top-0 bottom-0 w-64 glass-panel border-l border-white/10 z-20 overflow-y-auto",children:(0,r.jsx)(d,{})})}),(0,r.jsxs)("main",{className:"flex-1 w-full lg:mr-64 min-h-screen relative",children:[(0,r.jsx)(m,{onMenuClick:()=>l(!0)}),(0,r.jsx)("div",{className:"p-4 sm:p-6 lg:p-8",children:t})]})]})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-slate-400",children:"در حال هدایت..."})]})})}},9323:(e,t,s)=>{"use strict";async function r(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}s.d(t,{M3:()=>f,Wy:()=>v,aN:()=>g,iD:()=>x,ku:()=>m,kz:()=>h,lo:()=>c,ri:()=>p,saveUsers:()=>d,u6:()=>u});let a="users",n="users_backup",o=!1,l=!1;function i(e){if(!e)return null;try{let t=JSON.parse(e);return Array.isArray(t)?t:null}catch(e){return console.error("❌ Error parsing users JSON:",e),null}}function c(){let e=i(localStorage.getItem(a));if(e)return e;let t=i(localStorage.getItem(n));return t?(console.warn("⚠️ Using users_backup because users JSON is invalid"),t):(console.log("\uD83D\uDCCB No valid users found in localStorage"),[])}function d(e){try{if(!Array.isArray(e)){console.error("❌ Cannot save users: not an array",e);return}let t=localStorage.getItem(a);t&&localStorage.setItem(n,t),localStorage.setItem(a,JSON.stringify(e)),localStorage.setItem("users_last_updated",Date.now().toString()),console.log("✅ Saved users to localStorage:",e.length,"users"),"undefined"!=typeof fetch&&Promise.all([fetch("http://localhost:3000/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:e})}).catch(()=>null),fetch("http://localhost:3001/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:e})}).catch(()=>null)]).then(()=>{console.log("\uD83D\uDCE1 Synced users to both ports via API")}).catch(e=>{console.warn("⚠️ Failed to sync to API:",e)}),window.dispatchEvent(new CustomEvent("usersUpdated")),console.log("\uD83D\uDCE2 Dispatched usersUpdated event from saveUsers")}catch(e){console.error("❌ Error saving users:",e)}}function m(){if(o)return;o=!0;try{if("1"===window.sessionStorage.getItem("admin_users_migrated_once"))return}catch(e){}let e=localStorage.getItem(a),t=localStorage.getItem("admin_users"),s=i(e)||[];if(t)try{let e=i(t)||[];if(Array.isArray(e)&&e.length>0){let t=e.map(e=>{let t=new Date().toISOString();if(e.joinDate)try{let s=new Date(e.joinDate);isNaN(s.getTime())||(t=s.toISOString())}catch(e){t=new Date().toISOString()}return{id:e.id||Date.now()+Math.random(),name:e.name||"",email:e.email||"",phone:e.phone||"",role:"admin"===e.role?"admin":"user",passwordHash:e.passwordHash||"",createdAt:t,orders:e.orders||0,totalSpent:e.totalSpent||"۰",status:e.status||"active",joinDate:e.joinDate,visibleGiftCards:e.visibleGiftCards||[]}}),r=new Map,a=e=>{let t=e.email&&e.email.trim().toLowerCase()||e.phone&&e.phone.trim()||e.id.toString();r.has(t)||r.set(t,e)};s.forEach(a),t.forEach(a);let n=Array.from(r.values());n.length!==s.length&&(console.log("✅ Migrated and merged users from admin_users into users:","before:",s.length,"after:",n.length),d(n)),localStorage.removeItem("admin_users"),localStorage.setItem("admin_users_migrated","true");try{window.sessionStorage.setItem("admin_users_migrated_once","1")}catch(e){}}}catch(e){console.error("❌ Error migrating users:",e)}}async function u(){if(!l){l=!0;try{if("1"===window.sessionStorage.getItem("admin_seeded_once"))return}catch(e){}try{let e=c();if(0===e.length)console.log("ℹ️ No users found, seeding default admin user");else if(e.some(e=>"admin"===e.role||"admin@example.com"===e.email))return;let t=await r("Admin@12345"),s={id:Date.now(),name:"مدیر سیستم",email:"admin@example.com",phone:"",role:"admin",passwordHash:t,createdAt:new Date().toISOString(),orders:0,totalSpent:"۰",status:"active",visibleGiftCards:[]};e.push(s),d(e),console.log("✅ Seeded default admin user:",s.email);try{window.sessionStorage.setItem("admin_seeded_once","1")}catch(e){}}catch(e){console.error("❌ Error seeding admin user:",e)}}}async function h(e,t,s,a){try{let n=c(),o=t.trim(),l=s.trim();console.log("\uD83D\uDD0D Registering user:",{name:e,email:o,phone:l,totalUsers:n.length});let i=n.find(e=>o&&e.email&&e.email===o?(console.log("❌ Found existing user with email:",e.email),!0):!!l&&!!e.phone&&e.phone===l&&(console.log("❌ Found existing user with phone:",e.phone),!0));if(i)return console.log("❌ User already exists:",i),{success:!1,error:"این ایمیل یا شماره تلفن قبلاً ثبت شده است"};console.log("✅ No duplicate found, creating new user...");let m=await r(a),u={id:Date.now(),name:e.trim(),email:o,phone:l,role:"user",passwordHash:m,createdAt:new Date().toISOString(),orders:0,totalSpent:"۰",status:"active",visibleGiftCards:[]};n.push(u),d(n),console.log("✅ New user registered and saved:",{id:u.id,name:u.name,email:u.email,phone:u.phone,totalUsers:n.length});try{fetch("/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:n})}).then(()=>{console.log("\uD83D\uDCE1 Synced users to API endpoint")}).catch(e=>{console.warn("⚠️ Failed to sync to API:",e)})}catch(e){}return window.dispatchEvent(new CustomEvent("usersUpdated")),console.log("\uD83D\uDCE2 Dispatched usersUpdated event"),{success:!0,user:u}}catch(e){return console.error("Registration error:",e),{success:!1,error:"خطا در ثبت نام"}}}async function x(e,t){try{let s=c(),a=e.includes("@"),n=a?e.trim():"",o=a?"":e.trim(),l=s.find(e=>e.email===n||e.phone===o);if(!l)return{success:!1,error:"Invalid email/phone or password"};if(!l.passwordHash||""===l.passwordHash)return{success:!1,error:"این حساب کاربری نیاز به تنظیم مجدد رمز عبور دارد. لطفاً دوباره ثبت نام کنید."};let i=await r(t);if(l.passwordHash!==i)return{success:!1,error:"Invalid email/phone or password"};return localStorage.setItem("session_user_id",l.id.toString()),localStorage.setItem("user_email",l.email),localStorage.setItem("user_phone",l.phone),localStorage.setItem("user_name",l.name),{success:!0,user:l}}catch(e){return console.error("Login error:",e),{success:!1,error:"خطا در ورود"}}}function p(){localStorage.removeItem("session_user_id"),localStorage.removeItem("user_email"),localStorage.removeItem("user_phone"),localStorage.removeItem("user_name")}function g(){try{let e=localStorage.getItem("session_user_id");if(!e)return null;return c().find(t=>t.id.toString()===e)||null}catch(e){return console.error("Error getting session user:",e),null}}function f(){return null!==g()}function v(){p()}}},e=>{var t=t=>e(e.s=t);e.O(0,[6874,8441,1684,7358],()=>t(1304)),_N_E=e.O()}]);