(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{276:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(5155),o=r(2115),n=r(5695),a=r(6874),l=r.n(a),i=r(9323);function d(){(0,o.useEffect)(()=>{let e=document.documentElement,t=document.body,r=e.style.overflow,s=t.style.overflow,o=t.style.position,n=t.style.width;return e.style.overflow="hidden",t.style.overflow="hidden",t.style.position="fixed",t.style.width="100%",()=>{e.style.overflow=r,t.style.overflow=s,t.style.position=o,t.style.width=n}},[]);let e=(0,n.useRouter)(),[t,r]=(0,o.useState)(!1),[a,d]=(0,o.useState)(""),[c,u]=(0,o.useState)(null),m=e=>{if(e.length<6)return"weak";if(e.length<8)return"medium";let t=/[A-Z]/.test(e),r=/[a-z]/.test(e),s=[t,r,/[0-9]/.test(e),/[!@#$%^&*(),.?":{}|<>]/.test(e)].filter(Boolean).length;return s>=3?"strong":s>=2?"medium":"weak"},h=e=>{e.length>0?u(m(e)):u(null)},g=async t=>{t.preventDefault(),r(!0),d("");let s=new FormData(t.currentTarget),o=s.get("firstName"),n=s.get("lastName"),a=s.get("email"),l=s.get("phone"),c=s.get("password"),u=s.get("confirmPassword"),m="on"===s.get("acceptTerms");if(!o||!n||!a||!l||!c||!u){d("لطفاً تمام فیلدها را پر کنید"),r(!1);return}let h="".concat(o," ").concat(n).trim();if(h.length<2){d("نام باید حداقل ۲ کاراکتر باشد"),r(!1);return}if(c.length<8){d("رمز عبور باید حداقل ۸ کاراکتر باشد"),r(!1);return}if(c!==u){d("رمز عبور و تکرار آن مطابقت ندارند"),r(!1);return}if(!m){d("لطفاً با قوانین و مقررات موافقت کنید"),r(!1);return}try{let t=await (0,i.kz)(h,a.trim(),l.trim(),c);if(!t.success){d(t.error||"خطا در ثبت نام"),r(!1);return}e.push("/auth/login?registered=true")}catch(e){console.error("Registration error:",e),d("خطا در ثبت نام. لطفاً دوباره تلاش کنید."),r(!1)}};return(0,s.jsxs)("div",{className:"fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 z-50",style:{overflowY:"auto",WebkitOverflowScrolling:"touch"},children:[(0,s.jsx)("div",{className:"fixed inset-0 opacity-[0.03] pointer-events-none z-0",children:(0,s.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"radial-gradient(circle at 2px 2px, white 1px, transparent 0)",backgroundSize:"40px 40px"}})}),(0,s.jsx)("div",{className:"relative z-10 w-full max-w-md mx-auto px-4 py-8 min-h-screen flex items-start justify-center",children:(0,s.jsxs)("div",{className:"glass-card rounded-2xl p-6 sm:p-8 shadow-2xl border border-white/10",children:[(0,s.jsxs)("div",{className:"mb-8 text-center",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-green-500 to-blue-600 mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"ثبت نام"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"حساب کاربری جدید ایجاد کنید"})]}),a&&(0,s.jsxs)("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg text-sm text-red-300 flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),a]}),(0,s.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-300 mb-2",children:"نام"}),(0,s.jsx)("input",{id:"firstName",name:"firstName",type:"text",required:!0,disabled:t,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"نام",onFocus:e=>{setTimeout(()=>{let t=document.getElementById("register-submit-btn");t?t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}):e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-300 mb-2",children:"نام خانوادگی"}),(0,s.jsx)("input",{id:"lastName",name:"lastName",type:"text",required:!0,disabled:t,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"نام خانوادگی",onFocus:e=>{setTimeout(()=>{let t=document.getElementById("register-submit-btn");t?t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}):e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)}})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"md:order-1",children:[(0,s.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-300 mb-2",children:"شماره تلفن"}),(0,s.jsx)("input",{id:"phone",name:"phone",type:"tel",required:!0,disabled:t,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"09123456789",onFocus:e=>{setTimeout(()=>{let t=document.getElementById("register-submit-btn");t?t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}):e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)}})]}),(0,s.jsxs)("div",{className:"md:order-2",children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-2",children:"ایمیل"}),(0,s.jsx)("input",{id:"email",name:"email",type:"email",required:!0,disabled:t,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"example@email.com",onFocus:e=>{setTimeout(()=>{let t=document.getElementById("register-submit-btn");t?t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}):e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)}})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"رمز عبور"}),(0,s.jsx)("input",{id:"password",name:"password",type:"password",required:!0,disabled:t,onChange:e=>h(e.target.value),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"حداقل ۸ کاراکتر",onFocus:e=>{setTimeout(()=>{let t=document.getElementById("register-submit-btn");t?t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}):e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)}}),c&&(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex-1 h-2 bg-white/5 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full transition-all ".concat("weak"===c?"w-1/3 bg-red-500":"medium"===c?"w-2/3 bg-yellow-500":"w-full bg-green-500")})}),(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"weak"===c?"ضعیف":"medium"===c?"متوسط":"قوی"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-2",children:"تکرار رمز عبور"}),(0,s.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,disabled:t,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"رمز عبور را دوباره وارد کنید",onFocus:e=>{setTimeout(()=>{let t=document.getElementById("register-submit-btn");t?t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}):e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},300)}})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("input",{id:"acceptTerms",name:"acceptTerms",type:"checkbox",required:!0,disabled:t,className:"mt-1 w-4 h-4 rounded border-white/20 bg-white/5 text-green-500 focus:ring-2 focus:ring-green-500/50 disabled:opacity-50"}),(0,s.jsxs)("label",{htmlFor:"acceptTerms",className:"text-sm text-gray-400",children:["با"," ",(0,s.jsx)(l(),{href:"/terms",className:"text-green-400 hover:text-green-300",children:"قوانین و مقررات"})," ","موافقم"]})]}),(0,s.jsx)("button",{type:"submit",disabled:t,id:"register-submit-btn",className:"w-full py-3 bg-gradient-to-r from-green-500 to-blue-600 text-white font-semibold rounded-lg hover:shadow-lg hover:shadow-green-500/25 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:t?"در حال ثبت نام...":"ثبت نام"})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["قبلاً ثبت نام کرده‌اید؟"," ",(0,s.jsx)(l(),{href:"/auth/login",className:"text-green-400 hover:text-green-300 font-medium",children:"وارد شوید"})]})})]})})]})}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},8632:(e,t,r)=>{Promise.resolve().then(r.bind(r,276))},9323:(e,t,r)=>{"use strict";async function s(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}r.d(t,{M3:()=>b,Wy:()=>w,aN:()=>f,iD:()=>g,ku:()=>u,kz:()=>h,lo:()=>d,ri:()=>p,saveUsers:()=>c,u6:()=>m});let o="users",n="users_backup",a=!1,l=!1;function i(e){if(!e)return null;try{let t=JSON.parse(e);return Array.isArray(t)?t:null}catch(e){return console.error("❌ Error parsing users JSON:",e),null}}function d(){let e=i(localStorage.getItem(o));if(e)return e;let t=i(localStorage.getItem(n));return t?(console.warn("⚠️ Using users_backup because users JSON is invalid"),t):(console.log("\uD83D\uDCCB No valid users found in localStorage"),[])}function c(e){try{if(!Array.isArray(e)){console.error("❌ Cannot save users: not an array",e);return}let t=localStorage.getItem(o);t&&localStorage.setItem(n,t),localStorage.setItem(o,JSON.stringify(e)),localStorage.setItem("users_last_updated",Date.now().toString()),console.log("✅ Saved users to localStorage:",e.length,"users"),"undefined"!=typeof fetch&&Promise.all([fetch("http://localhost:3000/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:e})}).catch(()=>null),fetch("http://localhost:3001/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:e})}).catch(()=>null)]).then(()=>{console.log("\uD83D\uDCE1 Synced users to both ports via API")}).catch(e=>{console.warn("⚠️ Failed to sync to API:",e)}),window.dispatchEvent(new CustomEvent("usersUpdated")),console.log("\uD83D\uDCE2 Dispatched usersUpdated event from saveUsers")}catch(e){console.error("❌ Error saving users:",e)}}function u(){if(a)return;a=!0;try{if("1"===window.sessionStorage.getItem("admin_users_migrated_once"))return}catch(e){}let e=localStorage.getItem(o),t=localStorage.getItem("admin_users"),r=i(e)||[];if(t)try{let e=i(t)||[];if(Array.isArray(e)&&e.length>0){let t=e.map(e=>{let t=new Date().toISOString();if(e.joinDate)try{let r=new Date(e.joinDate);isNaN(r.getTime())||(t=r.toISOString())}catch(e){t=new Date().toISOString()}return{id:e.id||Date.now()+Math.random(),name:e.name||"",email:e.email||"",phone:e.phone||"",role:"admin"===e.role?"admin":"user",passwordHash:e.passwordHash||"",createdAt:t,orders:e.orders||0,totalSpent:e.totalSpent||"۰",status:e.status||"active",joinDate:e.joinDate,visibleGiftCards:e.visibleGiftCards||[]}}),s=new Map,o=e=>{let t=e.email&&e.email.trim().toLowerCase()||e.phone&&e.phone.trim()||e.id.toString();s.has(t)||s.set(t,e)};r.forEach(o),t.forEach(o);let n=Array.from(s.values());n.length!==r.length&&(console.log("✅ Migrated and merged users from admin_users into users:","before:",r.length,"after:",n.length),c(n)),localStorage.removeItem("admin_users"),localStorage.setItem("admin_users_migrated","true");try{window.sessionStorage.setItem("admin_users_migrated_once","1")}catch(e){}}}catch(e){console.error("❌ Error migrating users:",e)}}async function m(){if(!l){l=!0;try{if("1"===window.sessionStorage.getItem("admin_seeded_once"))return}catch(e){}try{let e=d();if(0===e.length)console.log("ℹ️ No users found, seeding default admin user");else if(e.some(e=>"admin"===e.role||"admin@example.com"===e.email))return;let t=await s("Admin@12345"),r={id:Date.now(),name:"مدیر سیستم",email:"admin@example.com",phone:"",role:"admin",passwordHash:t,createdAt:new Date().toISOString(),orders:0,totalSpent:"۰",status:"active",visibleGiftCards:[]};e.push(r),c(e),console.log("✅ Seeded default admin user:",r.email);try{window.sessionStorage.setItem("admin_seeded_once","1")}catch(e){}}catch(e){console.error("❌ Error seeding admin user:",e)}}}async function h(e,t,r,o){try{let n=d(),a=t.trim(),l=r.trim();console.log("\uD83D\uDD0D Registering user:",{name:e,email:a,phone:l,totalUsers:n.length});let i=n.find(e=>a&&e.email&&e.email===a?(console.log("❌ Found existing user with email:",e.email),!0):!!l&&!!e.phone&&e.phone===l&&(console.log("❌ Found existing user with phone:",e.phone),!0));if(i)return console.log("❌ User already exists:",i),{success:!1,error:"این ایمیل یا شماره تلفن قبلاً ثبت شده است"};console.log("✅ No duplicate found, creating new user...");let u=await s(o),m={id:Date.now(),name:e.trim(),email:a,phone:l,role:"user",passwordHash:u,createdAt:new Date().toISOString(),orders:0,totalSpent:"۰",status:"active",visibleGiftCards:[]};n.push(m),c(n),console.log("✅ New user registered and saved:",{id:m.id,name:m.name,email:m.email,phone:m.phone,totalUsers:n.length});try{fetch("/api/users/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:n})}).then(()=>{console.log("\uD83D\uDCE1 Synced users to API endpoint")}).catch(e=>{console.warn("⚠️ Failed to sync to API:",e)})}catch(e){}return window.dispatchEvent(new CustomEvent("usersUpdated")),console.log("\uD83D\uDCE2 Dispatched usersUpdated event"),{success:!0,user:m}}catch(e){return console.error("Registration error:",e),{success:!1,error:"خطا در ثبت نام"}}}async function g(e,t){try{let r=d(),o=e.includes("@"),n=o?e.trim():"",a=o?"":e.trim(),l=r.find(e=>e.email===n||e.phone===a);if(!l)return{success:!1,error:"Invalid email/phone or password"};if(!l.passwordHash||""===l.passwordHash)return{success:!1,error:"این حساب کاربری نیاز به تنظیم مجدد رمز عبور دارد. لطفاً دوباره ثبت نام کنید."};let i=await s(t);if(l.passwordHash!==i)return{success:!1,error:"Invalid email/phone or password"};return localStorage.setItem("session_user_id",l.id.toString()),localStorage.setItem("user_email",l.email),localStorage.setItem("user_phone",l.phone),localStorage.setItem("user_name",l.name),{success:!0,user:l}}catch(e){return console.error("Login error:",e),{success:!1,error:"خطا در ورود"}}}function p(){localStorage.removeItem("session_user_id"),localStorage.removeItem("user_email"),localStorage.removeItem("user_phone"),localStorage.removeItem("user_name")}function f(){try{let e=localStorage.getItem("session_user_id");if(!e)return null;return d().find(t=>t.id.toString()===e)||null}catch(e){return console.error("Error getting session user:",e),null}}function b(){return null!==f()}function w(){p()}}},e=>{var t=t=>e(e.s=t);e.O(0,[6874,8441,1684,7358],()=>t(8632)),_N_E=e.O()}]);